#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import C kivy.utils.get_color_from_hex
#:import ListItemButton kivy.uix.listview.ListItemButton
#:import CompositeListItem kivy.uix.listview.CompositeListItem
#:import ListAdapter kivy.adapters.listadapter.ListAdapter
#:import DictAdapter kivy.adapters.dictadapter.DictAdapter

<MainBtns@Button>:
    size_hint:(0.5,0.5)
    canvas:
        Color:
            rgba: (1,1,1,0)
        Rectangle:
            pos: self.pos
            size: self.size
    #background_color: (1,1,1,0)
    border: (10,10,10,10)
    background_normal: "media/images/border_norm.png"
    background_down: "media/images/border_down.png"
    color: C("#2C3E50")
    font_size:"30dp"

<TopLayout@AnchorLayout>:
    anchor_x: "center"
    anchor_y: "center"

<TopLabel@Label>:
    markup: True
    font_size: "20dp"
    bold: True

<DataInp@TextInput>:
    size_hint:(0.8,.8)
    multiline: False
    background_normal:'media/images/textinput.png'
	background_active:'media/images/textinput_active.png'
	background_disabled_normal:'media/images/textinput_disabled.png'
	background_disabled_active:'media/images/textinput_disabled.png'
	font_size: '14dp'
    italic: True
	cursor_color: 0.498, 0.549, 0.552,1.0
	foreground_color: 0.204, 0.286, 0.369, 1.0
	selection_color: 0.925, 0.941, 0.937, 0.5
	padding: 7,8
	halign:'justify'
	border: 10,10,10,10

<DataBtn@Button>:
    size_hint:(0.8,.8)
    font_size: '16dp'
	background_disabled_normal: 'media/images/but_disabled.png'
	background_disabled_down: 'media/images/but_disabled.png'
	border: 10,10,10,10
	background_normal:'media/images/but_blue_norm.png'
	background_down:'media/images/but_blue_down.png'

<ListItemLayout@BoxLayout>:
    canvas:
        Color:
            rgba: C("#1B2631")
        Rectangle:
            pos: self.pos
            size: self.size

#--------------Layout for each list item--------------------#
<Row@BoxLayout>:
    canvas.before:
        Color:
            rgba: C("#17202A")
        Rectangle:
            pos: self.pos
            size: self.size
    spacing: "10dp"

    sno: ''
    prd_name: ''
    tot_price: ''
    paid_price: ''
    due_amnt: ''

    #-------S. No. item--------#
    ListItemLayout:
        size_hint:(0.1,1)
        Label:
            id: lbl0
            text: root.sno
            font_size:"20dp"
            bold: True

    #-------prd_name item-------#
    ListItemLayout:
        size_hint:(0.3,1)

        BoxLayout:
            size_hint:(0.1,1)

        Label:
            id: lbl1
            size_hint:(0.8,1)
            text: root.prd_name
            font_size:"20dp"

        AnchorLayout:
            anchor_y: "top"
            anchor_x: "right"
            size_hint:(0.1,1)
            Button:
                size_hint_y: None
                size_hint_x: None
                size: 20,20
                background_normal: 'media/images/edit_icon_3.png'
                background_down: 'media/images/edit_icon_3.png'
                on_release:
                    app.root.ids.presScreen.update_data("Product Name",str(root.ids.lbl0.text), str(root.ids.lbl1.text), 'prd_name')

    #-------tot_price item-----#
    ListItemLayout:
        size_hint:(0.2,1)
        
        BoxLayout:
            size_hint:(0.1,1)

        Label:
            id: lbl2
            size_hint:(0.8,1)
            text: root.tot_price
            font_size:"20dp"

        AnchorLayout:
            anchor_y: "top"
            anchor_x: "right"
            size_hint:(0.1,1)
            Button:
                size_hint_y: None
                size_hint_x: None
                size: 20,20
                background_normal: 'media/images/edit_icon_3.png'
                background_down: 'media/images/edit_icon_3.png'
                on_release:
                    app.root.ids.presScreen.update_data("Total Price",str(root.ids.lbl0.text), str(root.ids.lbl2.text), 'tot_price')

    #-------paid_price item------#
    ListItemLayout:
        size_hint:(0.2,1)

        BoxLayout:
            size_hint:(0.1,1)

        Label:
            id: lbl3
            size_hint:(0.8,1)
            text: root.paid_price
            font_size:"20dp"

        AnchorLayout:
            anchor_y: "top"
            anchor_x: "right"
            size_hint:(0.1,1)
            Button:
                size_hint_y: None
                size_hint_x: None
                size: 20,20
                background_normal: 'media/images/edit_icon_3.png'
                background_down: 'media/images/edit_icon_3.png'
                on_release:
                    app.root.ids.presScreen.update_data("Amount Paid",str(root.ids.lbl0.text), str(root.ids.lbl3.text), 'paid_price')


    #-------due_amnt item--------#
    ListItemLayout:
        size_hint:(0.2,1)

        BoxLayout:
            size_hint:(0.1,1)

        Label:
            size_hint:(0.8,1)
            text: root.due_amnt
            font_size:"20dp"

        AnchorLayout:
            anchor_y: "center"
            anchor_x: "right"
            size_hint:(0.1,1)
            Button:
                size_hint_y: None
                size_hint_x: None
                size: 30,30
                background_normal: 'media/images/delete_icon2.png'
                background_down: 'media/images/delete_icon_down.png'
                on_release:
                    app.root.ids.presScreen.delete_data(str(root.ids.lbl0.text))

#-----------------Popup class for the edit part----------------#
<EditPop>:
    size_hint:(0.5,.5)
    pos_hint: {'y': -1}
    auto_dismiss: False
    on_open: app.root.ids.presScreen.anim_out(root)
    on_dismiss: app.root.ids.presScreen.anim_in(root)

    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        size: root.size
        pos: root.pos
        canvas:
            Color:
                rgb: C("#02011E")
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            size_hint:(0.8,0.8)
            orientation: "vertical"

            BoxLayout:
                orientation: "vertical"
                size_hint: (1,0.8)
                #canvas:
                #    Color:
                #        rgb: C("#1B4F72")
                #    Rectangle:
                #        pos: self.pos
                #        size: self.size

                BoxLayout:
                    #spacing: "10dp"
                    AnchorLayout:
                        anchor_x: "right"
                        anchor_y: "center"
                        Label:
                            text: "Previous Value:"
                            font_size: "20dp"

                    AnchorLayout:
                        anchor_x: "left"
                        anchor_y: "center"
                        DataInp:
                            id: prev_val
                            disabled: True
                            padding:7,7
                            size_hint:(0.8,None)
                            height: "35dp"
                            font_size:"17dp"
                            text: ''

                BoxLayout:
                    #spacing: "10dp"
                    AnchorLayout:
                        anchor_x: "right"
                        anchor_y: "center"
                        Label:
                            text: "New Value:"
                            font_size: "20dp"

                    AnchorLayout:
                        anchor_x: "left"
                        anchor_y: "center"
                        DataInp:
                            id: new_val
                            padding:7,7
                            size_hint:(0.8,None)
                            height: "35dp"
                            font_size: "17dp"
                            hint_text: "New value"

            BoxLayout:
                size_hint: (1,0.2)
                #canvas:
                #    Color:
                #        rgb: C("#4A235A")
                #    Rectangle:
                #        pos: self.pos
                #        size: self.size

                AnchorLayout:
                    anchor_x: "left"
                    anchor_y: "center"
                    Button:
                        size_hint:(0.6,None)
                        height: "40dp"
                        text: "Update"
                        background_normal:'media/images/but_grn_norm.png'
                        background_down:'media/images/but_grn_down.png'
                        on_release:
                            root.dismiss()
                            app.root.ids.presScreen.update(root.ids.new_val.text)

                AnchorLayout:
                    anchor_x: "right"
                    anchor_y: "center"
                    Button:
                        size_hint:(0.6,None)
                        height: "40dp"
                        text: "Cancel"
                        background_normal:'media/images/but_blue_norm.png'
                        background_down:'media/images/but_blue_down.png'
                        on_release:
                            root.dismiss()



#--------popup class for the delete part------------------#
<DeletePop>:
    size_hint:(0.5,.5)
    pos_hint: {'y': -1}
    auto_dismiss: False
    on_open: app.root.ids.presScreen.anim_out(root)
    on_dismiss: app.root.ids.presScreen.anim_in(root)

    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        size: root.size
        pos: root.pos
        canvas:
            Color:
                rgb: C("#02011E")
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            size_hint:(0.8,0.8)
            orientation: "vertical"

            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"
                size_hint: (1,0.8)

                Label:
                    text:"Once deleted, it can't be recovered!\nAre you sure, you want to delete it?"
                    font_size: "25dp"

            BoxLayout:
                size_hint: (1,0.2)

                AnchorLayout:
                    anchor_x: "left"
                    anchor_y: "center"
                    Button:
                        size_hint:(0.6,None)
                        height: "40dp"
                        text: "Delete"
                        border: 10,10,10,10
                        background_normal:'media/images/but_red_norm.png'
                        background_down:'media/images/but_red_down.png'
                        on_release:
                            app.root.ids.presScreen.delete()
                            root.dismiss()

                AnchorLayout:
                    anchor_x: "right"
                    anchor_y: "center"
                    Button:
                        size_hint:(0.6,None)
                        height:"40dp"
                        text: "Cancel"
                        border: 10,10,10,10
                        background_normal:'media/images/but_blue_norm.png'
                        background_down:'media/images/but_blue_down.png'
                        on_release: root.dismiss()


#------------- Root class of the app------------------------#
ScreenManager:
    MainScreen:
        id:mainScreen
    PreviousScreen:
        id: prevScreen
    PresentScreen:
        id: presScreen

#----------------------------------The Main Screen-------------------------------#
<MainScreen>:
    name: "MainScreen"
    canvas:
        Color:
            rgb: C("#101742")
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            size_hint: (1,0.1)
            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"

                Label:
                    text: "[size=20][i]Daily Dairy[/i][/size]"
                    markup: True

        BoxLayout:
            size_hint: (1,0.9)

            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"

                #canvas:
                #    Color:
                #        rgb: C("#3498DB")
                #    Rectangle:
                #        pos: self.pos
                #        size: self.size

                Label:
                    text: "[size=70][b]QWERTYUI ASD[/size][/b]\n[size=30][i]A brwea nojikr jdge[/i][/size]"
                    markup: True
                    halign: "center"
                    outline_color: 0.5,0,0
                    outline_width: 10

        AnchorLayout:
            anchor_x: "center"
            anchor_y: "center"

            #canvas:
            #    Color:
            #        rgb: C("#58D68D")
            #    Rectangle:
            #        pos: self.pos
            #        size: self.size

            GridLayout:
                size_hint: (1, 0.5)

                rows:1
                cols:2

                #canvas:
                #    Color:
                #        rgb: C("#CA6F1E")
                #    Rectangle:
                #        pos: self.pos
                #        size: self.size

                BoxLayout:
                    AnchorLayout:
                        anchor_x:"center"
                        anchor_y: "center"
                        #size_hint: (0.5,1)

                        MainBtns:
                            text: "Previous Pages"
                            on_release:
                                app.root.transition= SlideTransition(direction="right")
                                app.root.current= "PreviousScreen"

                BoxLayout:
                    AnchorLayout:
                        anchor_x:"center"
                        anchor_y: "center"
                        #size_hint: (0.5,1)

                        MainBtns:
                            text: "Present Page"
                            on_release:
                                app.root.transition= SlideTransition(direction="left")
                                app.root.current= "PresentScreen"

#-----------------------------PreviousScreen----------------------------------#
<PreviousScreen>:
    name: "PreviousScreen"
    canvas:
        Color:
            rgb: C("#010724")
        Rectangle:
            pos: self.pos
            size: self.size

    AnchorLayout:
        anchor_y: "center"
        size_hint:(1, 0.3)

        Button:
            text: "MainScreen"
            on_release:
                app.root.transition= SlideTransition(direction="left")
                app.root.current= "MainScreen"

#--------------------------PresentScreen--------------------------------------#
<PresentScreen>:
    prod_name: prod_name
    tot_price: tot_price
    paid_price: paid_price

    rv: rv

    name: "PresentScreen"
    canvas:
        Color:
            rgb: C("#5D6D7E")
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"

        #----------------------top bar----------------------------------#
        BoxLayout:
            size_hint: (1,0.07)
            canvas:
                Color:
                    rgb: C("#0860CE")
                Rectangle:
                    pos: self.pos
                    size: self.size

            TopLayout:
                size_hint_x:None
                width: 40
                Button:
                    size_hint:(None, None)
                    size: (40,40)
                    background_normal: 'media/images/back_arrow_norm.png'
                    background_down: 'media/images/back_arrow_down.png'
                    on_release:
                        app.root.transition= SlideTransition(direction="right")
                        app.root.current= "MainScreen"

            TopLayout:
                TopLabel:
                    id: date
                    text: "Date here"

            TopLayout:
                TopLabel:
                    id: holy_word
                    text: "Daily Diary"

            TopLayout:
                TopLabel:
                    id: time
                    text: "Time here"

        #---------------------database layout-------------------------------#
        BoxLayout:
            size_hint: (1,0.93)
            orientation: "vertical"

            #canvas:
            #    Color:
            #        rgb: C("#1B2631")
            #    Rectangle:
            #        pos: self.pos
            #        size: self.size

            #--------------inputs and buttons layout--------#
            BoxLayout:
                size_hint: (1,0.15)
                #spacing: "10dp"
                padding: "5dp"
                orientation: "vertical"
                canvas:
                    Color:
                        rgb: C("#1B2631")
                    Rectangle:
                        pos: self.pos
                        size: self.size

                #------take inputs over here---------------#
                BoxLayout:

                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "center"

                        DataInp:
                            id: prod_name
                            hint_text: "Product Name"
                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "center"

                        DataInp:
                            id: tot_price
                            hint_text: "Total Price"
                            input_filter: "int"

                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "center"

                        DataInp:
                            id: paid_price
                            hint_text: "Amount Paid"
                            input_filter: "int"

                #------utility buttons over here-------#
                BoxLayout:

                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "center"
                        DataBtn:
                            text: "Submit Data"
                            on_release:
                                root.submit()
                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "center"
                        DataInp:
                            id: search_text
                            hint_text: "Search Text..."

                    AnchorLayout:
                        anchor_x: "center"
                        anchor_y: "center"
                        DataBtn:
                            id: some_btn
                            text: "search"

            #-----------------Lists over here--------------#
            BoxLayout:
                size_hint:(1,0.85)
                orientation: "vertical"
                spacing: "5dp"

                canvas:
                    Color:
                        rgb: C("#000000")#BDC3C7
                    Rectangle:
                        pos: self.pos
                        size: self.size

                #---------header (S.no., product name....)---------#
                BoxLayout:
                    size_hint:(1, 0.07)
                    spacing:"5dp"
                    canvas:
                        Color:
                            rgb: C("#85C1E9")
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    TopLayout:
                        size_hint_x: 0.1
                        Label:
                            text: "S. No."
                            color: 0,0,0,1
                            bold: True

                    TopLayout:
                        size_hint_x: 0.3
                        Label:
                            text: "Product Name"
                            color: 0,0,0,1
                            bold: True

                    TopLayout:
                        size_hint_x: 0.2
                        Label:
                            text: "Total Price"
                            color: 0,0,0,1
                            bold: True

                    TopLayout:
                        size_hint_x: 0.2
                        Label:
                            text: "Amount Paid"
                            color: 0,0,0,1
                            bold: True

                    TopLayout:
                        size_hint_x: 0.2
                        Label:
                            text: "Dues"
                            color: 0,0,0,1
                            bold: True

                #-----------contains lists-------------------#
                BoxLayout:
                    size_hint: (1,0.93)
                    spacing:"5dp"

                    RecycleView:
                        id: rv
                        scroll_type: ['bars', 'content']
                        scroll_wheel_distance: dp(80)
                        bar_width: dp(7)
                        viewclass: 'Row'
                        data:[]
                        RecycleBoxLayout:
                            default_size: None, dp(56)
                            default_size_hint: 1, None
                            size_hint_y: None
                            height: self.minimum_height
                            orientation: "vertical"
                            spacing: dp(5)
